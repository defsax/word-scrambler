<html>
  <head>
    <title>Scrambler</title>
   	<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="reset.css">
		<link rel="stylesheet" href="style.css">
		<script src="input.js"></script>
  </head>
  <body>
  	<div id="main">
  		<h1 id="title">scramble / de-scramble</h1>
  		<br>
	  	<h2></h2>
	  	<form>
	  		<input type="text" name="scramble" placeholder="enter word(s)" onfocus="clear()" id="inputbox" autofocus>
	  		
	  		<p id="speedDisplay"><br>Speed: Slow...</p>
	  		<input type="range" min="1" max="10" value="10" name="speed" id="speedSlider">
	  		<br>
	  	</form>

	  	<button id="btn" type="button">go</button>
	  </div>
	  
	  <script id="worker">
      var randChar = [
        "a", "b", "c", "d", "e", "f", "g", "h", 
        "i", "j", "k", "l", "m", "n", "o", "p",
        "q", "r", "s", "t", "u", "v", "w", "x", 
        "y", "z", 
        "A", "B", "C", "D", "E", "F", "G", "H",
        "I", "J", "K", "L", "M", "N", "O", "P", 
        "Q", "R", "S", "T", "U", "V", "W", "X",
        "Y", "Z",
        "0", "1", "2", "3", "4", "5", "6", "7", "8", "9",
        "!", "@", "#", "$", "%", "^", "&", "*", 
        "(", ")", "_", "-", "+", "=", ":", ";",
        //"<", open bracket will cause html to hide the rest of the line
        ">", ".", "?", "/", "|", "{", "[", "]", "}", 
        " ", "\\", "\'", "\"", "å", "ß", "Ø", "Ö", "Õ"
        ];

      var correctWord;
      var speed;

      function loop(guessWord){
        //loop should start with guessWord and correctWord being the same length thanks to createGuessWord function
        for(var i = 0; i < guessWord.length; i++){
          //if guess letter at current element matches name at current 
          //element, push it on array and continue loop
          //otherwise, push on a random char
          if(guessWord[i] == correctWord[i]){
            guessWord[i] = correctWord[i];
            continue;
          }
          else
            guessWord[i] = randChar[Math.floor(Math.random() * randChar.length)];
        }
        postMessage(guessWord.join(''));
        setTimeout(function(){loop(guessWord);}, speed);
      }

      self.addEventListener('message', function(e){
        switch(e.data.cmd){
          case 'start':{
            correctWord = e.data.word;
            speed = Math.pow(e.data.speed, 2) * 10;
            loop(createGuessWord(correctWord));
            break;
          }
          case 'stop':{
            self.close();
            break;
          }
          case 'updateSpeed':{
            speed = Math.pow(e.data.speed, 2) * 10;
            break;
          }
          default:{
            postMessage("ERROR: Unknown command.");
            break;
          }
        }
      }, false);
      
      function createGuessWord(correctWord){
        let guessWord = [];
        for(let i = 0; i < correctWord.length; i++){
          guessWord.push("x");
        }
        postMessage(guessWord.join(''));
        return guessWord;
      }

	  </script>
  </body>
</html>
